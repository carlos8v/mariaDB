<form id="get-users-form" method="get" action="/admin/users" class="mb-12">
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
    <fieldset class="w-full flex flex-col items-start">
      <label for="name" class="block text-sm text-zinc-600 font-medium mb-1"
        >Nome</label
      >
      <input
        type="text"
        id="name"
        name="name"
        maxlength="25"
        class="border px-4 py-2 text-zinc-800 rounded border-zinc-300 w-full outline-indigo-500"
      />
    </fieldset>
    <fieldset class="w-full flex flex-col items-start">
      <label for="username" class="block text-sm text-zinc-600 font-medium mb-1"
        >Usuário</label
      >
      <input
        type="text"
        id="username"
        name="username"
        maxlength="25"
        class="border px-4 py-2 text-zinc-800 rounded border-zinc-300 w-full outline-indigo-500"
      />
    </fieldset>
    <div class="flex items-center justify-end gap-2">
      <button
        id="clear"
        type="button"
        class="w-42 py-2 text-zinc-600 cursor-pointer text-center rounded border border-zinc-400"
      >
        Limpar
      </button>
      <button
        type="submit"
        class="w-42 py-2 text-white cursor-pointer text-center rounded bg-indigo-500 hover:bg-indigo-800 transition"
      >
        Buscar
      </button>
    </div>
  </div>
</form>
<div class="overflow-x-auto">
  <table id="users-table" class="table-fixed w-full min-w-lg my-4">
    <thead>
      <tr class="border-y border-zinc-200">
        <th class="w-[280px] font-normal text-zinc-500 text-left py-4">
          Usuário
        </th>
        <th class="w-[280px] font-normal text-zinc-500 text-left py-4">Nome</th>
        <th class="w-[280px] font-normal text-zinc-500 text-left py-4">
          Descrição
        </th>
        <th class="w-[120px] font-normal text-zinc-500 text-left py-4">
          Links
        </th>
        <th class="w-[120px] font-normal text-zinc-500 text-center py-4">
          Opções
        </th>
      </tr>
    </thead>
    <tbody id="users-list-body"></tbody>
  </table>
</div>
<script>
  const userFilterForm = document.querySelector("#get-users-form");
  const body = document.querySelector("#users-table #users-list-body");

  function addLoading() {
    body.innerHTML = "";

    const loadingTd = document.createElement("td");
    loadingTd.setAttribute("colspan", "5");
    loadingTd.classList.add(
      ..."text-center py-4 text-zinc-600 animate-pulse border-b border-zinc-200".split(
        " "
      )
    );
    loadingTd.innerText = "Carregando";

    const loadingTr = document.createElement("tr");
    loadingTr.id = "users-list-loading";
    loadingTr.appendChild(loadingTd);

    body.appendChild(loadingTr);
  }

  async function searchUsers(formData = new FormData()) {
    addLoading();

    const searchParams = new URLSearchParams(formData);

    fetch(`/admin/users?${searchParams.toString()}`, {
      method: "GET",
      credentials: "include",
    })
      .then((r) => r.text())
      .then((response) => {
        body.innerHTML = response;

        feather.replace();
      });
  }

  function clearValues() {
    const name = document.querySelector("#get-users-form #name");
    const username = document.querySelector("#get-users-form #username");

    name.value = "";
    username.value = "";
  }

  document
    .querySelector("#get-users-form #clear")
    .addEventListener("click", clearValues);

  document.querySelector("#get-users-form").addEventListener("submit", (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);

    searchUsers(formData);
  });

  searchUsers();
</script>
